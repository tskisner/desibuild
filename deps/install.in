#!/bin/bash

# Install DESI dependencies from source.

mkdir -p @CONDA_ROOT@/bin
mkdir -p @CONDA_ROOT@/lib
mkdir -p @PREFIX@/lib/python3.5/site-packages

export PATH=@PREFIX@/bin:@CONDA_ROOT@/bin:${PATH}
export CPATH=@PREFIX@/include:${CPATH}
export LIBRARY_PATH=@PREFIX@/lib:${LIBRARY_PATH}
export LD_LIBRARY_PATH=@PREFIX@/lib:${LD_LIBRARY_PATH}
export PYTHONPATH=@PREFIX@/lib/python3.5/site-packages:${PYTHONPATH}

export ACCEPT_INTEL_PYTHON_EULA=yes

# Install conda root environment

@conda_root@

# Install conda packages.

@conda_pkgs@

# Install pip packages.

@pip_pkgs@

# Install mpi4py.

@mpi4py@

# Install CFITSIO.

@cfitsio@

# Install FFTW.

@fftw@

# Install BOOST.

@boost@

# Install HARP.

@harp@

# Install modulefile

# if [ "x@MODULE_DIR@" != "x" ]; then
#     modload="@CONFFILE@.modload"
#     modin="modulefile.in"
#     modout=""

#     while IFS='' read -r line || [[ -n "${line}" ]]; do
#         match="no"

#             if [[ "${line}" =~ @${rule}@ ]]; then
#                 match="yes"
#                 echo -n "${precommand} " >> "${outfile}"
#                 cat "${rulefile}" >> "${outfile}"
#                 break
#             fi
#         done
#         if [ "${match}" = "no" ]; then
#             echo "${line}" >> "${outfile}"
#         fi
#     done < "${modulefile.in}"


#     echo '
# @@
# ' >> "@MODULE_DIR@"



